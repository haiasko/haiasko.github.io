<!DOCTYPE html>
<html>
<head>
    <title>Me tinkering</title>

    <!-- Bootstrap's tinkering (without the Bootstrap) -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- End Bootstrap's tinkering -->

    <!-- Ractive tinkering here -->

    <script type="text/javascript">
        (function() {
            var method;
            var noop = function () {};
            var methods = [
                'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
                'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
                'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
                'timeStamp', 'trace', 'warn'
            ];
            var length = methods.length;
            var console = (window.console = window.console || {});

            while (length--) {
                method = methods[length];

                // Only stub undefined methods.
                if (!console[method]) {
                    console[method] = noop;
                }
            }
        }());
    </script>

    <!-- Latest Ractive, change to CDN -->
    <script src='Ractive.js'></script>

    <!-- end Ractive tinkering  -->

    <!-- my stuff -->

    <style>
        body{
        font-family:sans-serif, Arial;
        }
	.myred {
	color:red;
	}
	.mydrag {
	color:purple;
	}
	.mystatus {
	color:blue;
	}
    </style

    <!-- end my stuff -->

    <!-- Here be dragons styles -->

    <!-- Stolen from http://jsfiddle.net/KJQ9K/ -->

    <style>
      pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }
      .string { color: green; }
      .number { color: darkorange; }
      .boolean { color: blue; }
      .null { color: magenta; }
      .key { color: red; }
    </style>
    <!-- end Here be dragons styles -->

</head>
<body>

    <h1>DFtest2</h1>

    <p class=myred>  start </p><hr>

    <div id='container'></div>

    <p>--------</p>

    <hr><p class="myred"> end </p>
    
    <script id='myTemplate' type='text/ractive'>

      {{#status}}
      <p class="mystatus">{{status}}</p>
      {{/status}}

      {{#loggedIn}}
      <p>Logged in: {{loggedIn}}</p>
      <button onclick="ractive.set('loggedIn', false)">Log Out</button>
      {{/loggedIn}}

      {{^loggedIn}}
      <p>You are not logged in</p>
      E-mail: <input type="email" value='{{email}}'><br/>
      Password: <input type="password" value='{{password}}'><br/>
      <button onclick="myLogin()">Log In</button>
      {{/loggedIn}}

    </script>

    <script>
      var ractive = new Ractive({
      el: 'container',
      template: '#myTemplate',
      data: { status: "", loggedIn: false, email: undefined, password: undefined, response: undefined }
      });
    </script>


    <script id='myEval' type='text/ractive'>

      expr: <input type="text" value='{{toeval}}'><br/>
      result: <pre>{{{myev(toeval)}}}</pre><br/>

    </script>
   
    <!-- My main stuff here -->

    <script>
    
      function myLogin () {
        var body = {
          email: ractive.get('email'),
          password: ractive.get('password')
        };
        window.df.apis.user.login({body: body}, function (response) {
          
        //assign session token to be used for the session duration
            window.authorizations.add("X-DreamFactory-Session-Token", new ApiKeyAuthorization("X-Dreamfactory-Session-Token", response.session_id, 'header'));
            ractive.set('loggedIn', true); 
            ractive.set('response', response); 
        }, function(response){
            ractive.set('status', myGetErrorString(response));
            ractive.set('loggedIn', false); 
            ractive.set('response', response); 
        });
      }

    myGetErrorString = function(response){
        var msg = "An error occurred, but the server provided no additional information.";
        if (response.content && response.content.data && response.content.data.error) {
            msg = response.content.data.error[0].message;
        }
        msg = msg.replace(/&quot;/g, '"').replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&').replace(/&apos;/g, '\'');
        return msg;
    };
													</script>
      
    <!-- end My main stuff here -->

    <!-- simple expr eval for debugging -->

    <p class="mydrag"> Here be dragons </p>

    <div id='evalContainer'></div>

    <script>
      var evalRactive = new Ractive({
      el: 'evalContainer',
      template: '#myEval',
      data: {myev: function(i) {
        return syntaxHighlight(JSON.stringify(eval(i), undefined, 4));
      }
      }
      });
    </script>

    <!-- Stolen from http://jsfiddle.net/KJQ9K/ -->

    <script>

function syntaxHighlight(json) {
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        var cls = 'number';
        if (/^"/.test(match)) {
            if (/:$/.test(match)) {
                cls = 'key';
            } else {
                cls = 'string';
            }
        } else if (/true|false/.test(match)) {
            cls = 'boolean';
        } else if (/null/.test(match)) {
            cls = 'null';
        }
        return '<span class="' + cls + '">' + match + '</span>';
    });
}

<!-- var obj = {a:1, 'b':'foo', c:[false,'false',null, 'null', {d:{e:1.3e5,f:'1.3e5'}}]}; -->
<!-- var str = JSON.stringify(obj, undefined, 4); -->
<!-- function output(inp) { -->
<!--     document.body.appendChild(document.createElement('pre')).innerHTML = inp; -->
<!-- } -->
<!-- output(str); -->
<!-- output(syntaxHighlight(str)); -->

</script>

<!-- end of Stolen from http://jsfiddle.net/KJQ9K/ -->


<p class="mydrag"> end dragons </p>




<script src='lib/shred.bundle.js' type='text/javascript'></script>
<script src='lib/swagger.js' type='text/javascript'></script>
<script src='lib/sdk-init.js' type='text/javascript'></script>
<script src='dftest2.js' type='text/javascript'></script>

</body>
</html>
