<!DOCTYPE html>
<html>
<head>
    <title>Me tinkering</title>

    <!-- Bootstrap's tinkering (without the Bootstrap) -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- End Bootstrap's tinkering -->

    <!-- Ractive tinkering here -->

    <script type="text/javascript">
        (function() {
            var method;
            var noop = function () {};
            var methods = [
                'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
                'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
                'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
                'timeStamp', 'trace', 'warn'
            ];
            var length = methods.length;
            var console = (window.console = window.console || {});

            while (length--) {
                method = methods[length];

                // Only stub undefined methods.
                if (!console[method]) {
                    console[method] = noop;
                }
            }
        }());
    </script>

    <!-- Latest Ractive, change to CDN -->
    <script src='Ractive.js'></script>

    <!-- end Ractive tinkering  -->

    <!-- my stuff -->

    <style>
        body{
        font-family:sans-serif, Arial;
        }
	.myred {
	color:red;
	}
	.mydrag {
	color:purple;
	}
	.mystatus {
	color:blue;
	}
    </style

    <!-- end my stuff -->

    <!-- Here be dragons styles -->

    <!-- Stolen from http://jsfiddle.net/KJQ9K/ -->

    <style>
      pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }
      .string { color: green; }
      .number { color: darkorange; }
      .boolean { color: blue; }
      .null { color: magenta; }
      .key { color: red; }
    </style>
    <!-- end Here be dragons styles -->

</head>
<body>

    <h1>My DB page</h1>

    <p class=myred>  start </p>

    <div id='container'></div>

    <p>--------</p>

    <div id='evalContainer'></div>

    <p class="myred"> end </p>
    
    <script id='myTemplate' type='text/ractive'>

      {{#status}}
      <p class="mystatus">{{status}}</p>
      {{/status}}

      {{#loggedIn}}
      <p>Logged in: {{loggedIn}}</p>
      <button onclick="ractive.set('loggedIn', false)">Log Out</button>
      {{/loggedIn}}

      {{^loggedIn}}
      <p>You are not logged in</p>
      E-mail: <input type="email" value='{{email}}'><br/>
      Password: <input type="password" value='{{password}}'><br/>
      <button onclick="myLogin()">Log In</button>
      {{/loggedIn}}

    </script>

    <script>
      var ractive = new Ractive({
      el: 'container',
      template: '#myTemplate',
      data: { status: "", loggedIn: false, email: undefined, password: undefined }
      });
    </script>


    <script id='myEval' type='text/ractive'>

      expr: <input type="text" value='{{toeval}}'><br/>
      result: <pre>{{{myev(toeval)}}}</pre><br/>

    </script>
   
    <!-- My main stuff here -->

    <script>
    
      function myLogin () {
        var body = {
          email: ractive.get('email'),
          password: ractive.get('password')
        };
        window.df.apis.user.login({body: body}, function (response) {
          
        //assign session token to be used for the session duration
            window.authorizations.add("X-DreamFactory-Session-Token", new ApiKeyAuthorization("X-Dreamfactory-Session-Token", response.session_id, 'header'));
            ractive.set('loggedIn', true); 
        }, function(response){
            ractive.set('status', myGetErrorString(response));
            ractive.set('loggedIn', false); 
        });
      }

    myGetErrorString = function(response){
        var msg = "An error occurred, but the server provided no additional information.";
        if (response.content && response.content.data && response.content.data.error) {
            msg = response.content.data.error[0].message;
        }
        msg = msg.replace(/&quot;/g, '"').replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&').replace(/&apos;/g, '\'');
        return msg;
    };
												</script>
      
    <!-- end My main stuff here -->

    <!-- simple expr eval for debugging -->

    <script>
      var evalRactive = new Ractive({
      el: 'evalContainer',
      template: '#myEval',
      data: {myev: function(i) {
        return syntaxHighlight(JSON.stringify(eval(i), undefined, 4));
      }
      }
      });
    </script>

    
    <p class="mydrag"> Here be dragons </p>

    <!-- Stolen from http://jsfiddle.net/KJQ9K/ -->

    <script>

function output(inp) {
    document.body.appendChild(document.createElement('pre')).innerHTML = inp;
}

function syntaxHighlight(json) {
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        var cls = 'number';
        if (/^"/.test(match)) {
            if (/:$/.test(match)) {
                cls = 'key';
            } else {
                cls = 'string';
            }
        } else if (/true|false/.test(match)) {
            cls = 'boolean';
        } else if (/null/.test(match)) {
            cls = 'null';
        }
        return '<span class="' + cls + '">' + match + '</span>';
    });
}

var obj = {a:1, 'b':'foo', c:[false,'false',null, 'null', {d:{e:1.3e5,f:'1.3e5'}}]};
var str = JSON.stringify(obj, undefined, 4);

output(str);
output(syntaxHighlight(str));
</script>

<!-- end of Stolen from http://jsfiddle.net/KJQ9K/ -->


<p class="mydrag"> end dragons </p>



<h1>Original index.html</h1>

<p>
    This auto-generated index.html file is the starting point for your application.
</p>

<p>The Javascript SDK is a convenience wrapper for all the methods in our REST API. The SDK contains your REST endpoint and API key so you can start coding immediately. When a new service is provisioned in the Admin Console the JavaScript SDK will automatically include that service the next time your application is loaded.</p>

<p>Access the SDK by using the "df" object. You can see the "df" object in your debugger by opening up the DOM inspection tab. The "df" object is attached to the "window" object. For example, using Chrome's Dev Tools, open the console and start typing "window.df.apis" to display all the methods and properties.</p>

<p>Use of this SDK on the local file system requires "*" to be in your list of allowed hosts in the CORS configuration section of the Admin app.</p>
<br/>
<p>
    View the <a href="readme.html">README</a> for helpful information and tutorials, including CORs access, authentication, and sessions.
</p>

<h3>Making API calls</h3>


<p>---------------------------------------------------------------------------------------------------------------------------------------------------------</p>

<p><b>Authenticate into your DreamFactory Services Platform</b><br/>
<p>First, log in to your DreamFactory Services Platform to see these API calls work.</p>
<p>

    <input type="email" id="email"><br/>
    <input type="password" id="password"><br/>
    <button onclick="window.app.login()">Log In</button>
<div id="login-status" style="color:blue"></div>


<p>---------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<P><b>Retrieve records from the "todo" sample table located in your DreamFactory Services Platform</b></P>

<pre>
   window.df.apis.db.getRecords({table_name: "todo"}, function (response) {
          //Do something with the data;
            console.log(response);
        });
</pre>
<button style="display:none" id="try-now-get" onclick="window.app.getTodos()">Try it Now</button><br/>
<p><b>Response:</b></p>
<textarea class="results" style="width:400px;height:200px" id="get-results">Loading APIs...</textarea>


<p>---------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<P><b>Insert records into the "todo" sample table located in your DreamFactory Services Platform</b></P>

<pre>
        var item = {"record":[{"name":"New Item","complete":false}]};
        window.df.apis.db.createRecords({"table_name":"todo", "body":item}, function(response) {
            document.getElementById("post-results").innerHTML = JSON.stringify(response);
        }, function(response) {
            document.getElementById("post-results").innerHTML = JSON.stringify(response);
        });
</pre>
<button style="display:none" id="try-now-post" onclick="window.app.addTodo()">Try it Now</button><br/>
<p><b>Response:</b></p>
<textarea class="results" style="width:400px;height:200px" id="post-results">Loading APIs...</textarea>

<p>---------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<P><b>Update a record to be complete in the "todo" sample table located in your DreamFactory Services Platform</b></P>

<pre>
        var id= document.getElementById("update-id").value;
        var complete = true;
        var item = {"record":[{"id":id,"complete":complete}]};
        df.apis.db.updateRecords({"table_name":"todo", "body":item}, function(response) {
            document.getElementById("update-results").innerHTML = JSON.stringify(response);
        }, function(response) {
            document.getElementById("update-results").innerHTML = JSON.stringify(response);
        });
</pre>
ID of record to update : <input type="text" id="update-id">
<button style="display:none" id="try-now-update" onclick="window.app.updateTodo()">Try it Now</button><br/>
<p><b>Response:</b></p>
<textarea class="results" style="width:400px;height:200px" id="update-results">Loading APIs...</textarea>

<p>---------------------------------------------------------------------------------------------------------------------------------------------------------</p>

<P><b>Delete a record from the "todo" sample table located in your DreamFactory Services Platform</b></P>
<pre>
        var id= document.getElementById("delete-id").value;
        window.df.apis.db.deleteRecords({"table_name":"todo", "ids":id}, function(response) {
            document.getElementById("delete-results").innerHTML = JSON.stringify(response);
        }, function(response) {
            document.getElementById("delete-results").innerHTML = JSON.stringify(response);
        });
</pre>
ID of record to delete : <input type="text" id="delete-id">
<button style="display:none" id="try-now-delete" onclick="window.app.deleteTodo()">Try it Now</button><br/>
<p><b>Response:</b></p>
<textarea class="results" style="width:400px;height:200px" id="delete-results">Loading APIs...</textarea>


<script src='lib/shred.bundle.js' type='text/javascript'></script>
<script src='lib/swagger.js' type='text/javascript'></script>
<script src='lib/sdk-init.js' type='text/javascript'></script>
<script src='app.js' type='text/javascript'></script>

</body>
</html>
